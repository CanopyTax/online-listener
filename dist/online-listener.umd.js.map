{"version":3,"file":"online-listener.umd.js","sources":["../src/online-listener.js"],"sourcesContent":["import { ReplaySubject, interval, from } from \"rxjs\";\nimport { switchMap, tap, filter } from \"rxjs/operators\";\n\nconst onlineSubject$ = new ReplaySubject(1);\nconst online$ = onlineSubject$.asObservable();\nlet urlToHit;\n\nonlineSubject$.next(navigator.onLine);\n\nfunction updateOnlineStatus(evt) {\n  if (navigator && navigator.onLine != undefined) {\n    onlineSubject$.next(navigator.onLine);\n  }\n}\n\nwindow.addEventListener(\"offline\", updateOnlineStatus);\nwindow.addEventListener(\"online\", () => createPoll());\n\nfunction checkIfOnline() {\n  if (urlToHit) {\n    return fetch(urlToHit).catch(e => {\n      console.warn(`polling failed`, e);\n      return {};\n    });\n  } else {\n    console.warn(`polling url needs to be set`);\n    return Promise.resolve({});\n  }\n}\n\nlet pollingSubscription;\n\nfunction createPoll() {\n  clearPoll();\n  pollingSubscription = interval(1000)\n    .pipe(\n      filter(i => {\n        if (i === 0) {\n          return true;\n        } else if (i <= 15) {\n          return i % 5 === 0;\n        } else if (i >= 20) {\n          return i % 10 === 0;\n        }\n      }),\n      switchMap(() => from(checkIfOnline()))\n    )\n    .subscribe(results => {\n      if (results.status === 200) {\n        onlineSubject$.next(true);\n        clearPoll();\n      }\n    });\n}\n\nfunction clearPoll() {\n  if (pollingSubscription && pollingSubscription.unsubscribe) {\n    pollingSubscription.unsubscribe();\n  }\n}\n\nfunction setPollingUrl(url) {\n  urlToHit = url;\n}\n\nexport const onlineListener = online$;\nexport { setPollingUrl };\n"],"names":["checkIfOnline","urlToHit","fetch","catch","e","console","warn","Promise","resolve","createPoll","clearPoll","pollingSubscription","interval","pipe","filter","i","switchMap","from","subscribe","results","status","onlineSubject$","next","unsubscribe","ReplaySubject","online$","asObservable","navigator","onLine","window","addEventListener","url"],"mappings":"2SAkBA,QAASA,CAAAA,CAAT,EAAyB,OACnBC,CAAAA,CADmB,CAEdC,KAAK,CAACD,CAAD,CAALC,CAAgBC,KAAhBD,CAAsBE,CAAC,GAC5BC,OAAO,CAACC,IAARD,iBAAAA,CAA+BD,CAA/BC,CAD4B,CAErB,EAFqB,CAAvBH,CAFc,EAOrBG,OAAO,CAACC,IAARD,8BAAAA,CAPqB,CAQdE,OAAO,CAACC,OAARD,CAAgB,EAAhBA,CARc,EAczB,QAASE,CAAAA,CAAT,EAAsB,CACpBC,CAAS,EADW,CAEpBC,CAAmB,CAAGC,UAAAA,CAAS,GAATA,EACnBC,IADmBD,CAElBE,QAAAA,CAAOC,CAAC,EAAI,IACA,CAANA,GAAAA,WADM,MAGM,GAALA,EAAAA,CAHD,CAIS,CAAVA,EAAAA,CAAC,CAAG,CAJH,CAKM,EAALA,EAAAA,CALD,CAMU,CAAXA,EAAAA,CAAC,CAAG,EANH,OAAN,CAAND,CAFkBF,CAWlBI,WAAAA,CAAU,IAAMC,MAAAA,CAAKjB,CAAa,EAAlBiB,CAAhBD,CAXkBJ,EAanBM,SAbmBN,CAaTO,CAAO,EAAI,CACG,GAAnBA,GAAAA,CAAO,CAACC,MADQ,GAElBC,CAAc,CAACC,IAAfD,IAFkB,CAGlBX,CAAS,EAHS,CAbF,CAAAE,EAqBxB,QAASF,CAAAA,CAAT,EAAqB,CACfC,CAAmB,EAAIA,CAAmB,CAACY,WAD5B,EAEjBZ,CAAmB,CAACY,WAApBZ,QAtDEU,CAAAA,CAAc,CAAG,GAAIG,CAAAA,eAAJ,CAAkB,CAAlB,EACjBC,CAAO,CAAGJ,CAAc,CAACK,YAAfL,GAChB,GAAIpB,CAAAA,CAAJ,CAEAoB,CAAc,CAACC,IAAfD,CAAoBM,SAAS,CAACC,MAA9BP,EAQAQ,MAAM,CAACC,gBAAPD,CAAwB,SAAxBA,CANA,UAAiC,CAC3BF,SAAS,EAAIA,SAAS,CAACC,MAAVD,MADc,EAE7BN,CAAc,CAACC,IAAfD,CAAoBM,SAAS,CAACC,MAA9BP,EAIJQ,EACAA,MAAM,CAACC,gBAAPD,CAAwB,QAAxBA,CAAkC,IAAMpB,CAAU,EAAlDoB,EAcA,GAAIlB,CAAAA,CAAJ,kBAmC8Bc,kBAJ9B,SAAuBM,CAAvB,CAA4B,CAC1B9B,CAAQ,CAAG8B"}