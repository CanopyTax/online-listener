{"version":3,"file":"online-listener.umd.js","sources":["../src/online-listener.js","../src/index.js"],"sourcesContent":["import { ReplaySubject, interval, from } from 'rxjs'\nimport {\n  switchMap,\n  tap,\n  filter,\n} from 'rxjs/operators'\n\nconst onlineSubject$ = new ReplaySubject(1)\nconst online$ = onlineSubject$.asObservable()\nlet urlToHit\n\nonlineSubject$.next(true)\n\nfunction updateOnlineStatus (evt) {\n  if (navigator && navigator.onLine != undefined) {\n    onlineSubject$.next(navigator.onLine)\n  }\n}\n\nwindow.addEventListener('offline', updateOnlineStatus)\nwindow.addEventListener('online', () => createPoll())\n\nfunction checkIfOnline () {\n  if (urlToHit) {\n    return fetch(urlToHit).catch(e => {\n      console.warn(`polling failed`, e)\n      return {}\n    })\n  } else {\n    console.warn(`polling url needs to be set`)\n    return Promise.resolve({})\n  }\n}\n\nlet pollingSubscription\n\nfunction createPoll() {\n  clearPoll()\n  pollingSubscription = interval(1000).pipe(\n    filter((i) => {\n      if (i === 0) {\n        return true\n      } else if (i <= 15) {\n        return i % 5 === 0\n      } else if (i >= 20) {\n        return i % 10 === 0\n      }\n    }),\n    switchMap(() => from(checkIfOnline()))\n  ).subscribe(\n    (results) => {\n      if (results.status === 200) {\n        onlineSubject$.next(true)\n        clearPoll()\n      }\n    }\n  )\n}\n\nfunction clearPoll() {\n  if (pollingSubscription && pollingSubscription.unsubscribe) {\n    pollingSubscription.unsubscribe()\n  }\n}\n\nfunction setPollingUrl (url) {\n  urlToHit = url\n}\n\nexport {\n  online$,\n  setPollingUrl,\n}\n","import { online$ } from './online-listener.js'\n\nexport const onlineListener = online$\nexport { setPollingUrl } from './online-listener.js'\n"],"names":["checkIfOnline","urlToHit","fetch","catch","e","console","warn","Promise","resolve","createPoll","clearPoll","pollingSubscription","interval","pipe","filter","i","switchMap","from","subscribe","results","status","onlineSubject$","next","unsubscribe","ReplaySubject","online$","asObservable","window","addEventListener","navigator","onLine","url"],"mappings":"2SAsBA,QAASA,CAAAA,CAAT,EAA0B,OACpBC,CAAAA,CADoB,CAEfC,KAAK,CAACD,CAAD,CAALC,CAAgBC,KAAhBD,CAAsBE,CAAC,GAC5BC,OAAO,CAACC,IAARD,iBAAAA,CAA+BD,CAA/BC,CAD4B,CAErB,EAFqB,CAAvBH,CAFe,EAOtBG,OAAO,CAACC,IAARD,8BAAAA,CAPsB,CAQfE,OAAO,CAACC,OAARD,CAAgB,EAAhBA,CARe,EAc1B,QAASE,CAAAA,CAAT,EAAsB,CACpBC,CAAS,EADW,CAEpBC,CAAmB,CAAGC,UAAAA,CAAS,GAATA,EAAeC,IAAfD,CACpBE,QAAAA,CAAQC,CAAD,EAAO,IACF,CAANA,GAAAA,WADQ,MAGI,GAALA,EAAAA,CAHC,CAIO,CAAVA,EAAAA,CAAC,CAAG,CAJD,CAKI,EAALA,EAAAA,CALC,CAMQ,CAAXA,EAAAA,CAAC,CAAG,EAND,OAAR,CAAND,CADoBF,CAUpBI,WAAAA,CAAU,IAAMC,MAAAA,CAAKjB,CAAa,EAAlBiB,CAAhBD,CAVoBJ,EAWpBM,SAXoBN,CAYnBO,CAAD,EAAa,CACY,GAAnBA,GAAAA,CAAO,CAACC,MADD,GAETC,CAAc,CAACC,IAAfD,IAFS,CAGTX,CAAS,EAHA,CAZO,CAAAE,EAqBxB,QAASF,CAAAA,CAAT,EAAqB,CACfC,CAAmB,EAAIA,CAAmB,CAACY,WAD5B,EAEjBZ,CAAmB,CAACY,WAApBZ,QAtDEU,CAAAA,CAAc,CAAG,GAAIG,CAAAA,eAAJ,CAAkB,CAAlB,EACjBC,CAAO,CAAGJ,CAAc,CAACK,YAAfL,GAChB,GAAIpB,CAAAA,CAAJ,CAEAoB,CAAc,CAACC,IAAfD,KAQAM,MAAM,CAACC,gBAAPD,CAAwB,SAAxBA,CANA,UAAkC,CAC5BE,SAAS,EAAIA,SAAS,CAACC,MAAVD,MADe,EAE9BR,CAAc,CAACC,IAAfD,CAAoBQ,SAAS,CAACC,MAA9BT,EAIJM,EACAA,MAAM,CAACC,gBAAPD,CAAwB,QAAxBA,CAAkC,IAAMlB,CAAU,EAAlDkB,EAcA,GAAIhB,CAAAA,CAAJ,kBChC8Bc,kBD+D9B,SAAwBM,CAAxB,CAA6B,CAC3B9B,CAAQ,CAAG8B"}