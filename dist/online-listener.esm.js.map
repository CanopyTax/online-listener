{"version":3,"file":"online-listener.esm.js","sources":["../src/online-listener.js","../src/index.js"],"sourcesContent":["import { ReplaySubject, interval, from } from 'rxjs'\nimport {\n  switchMap,\n  tap,\n  filter,\n} from 'rxjs/operators'\n\nconst onlineSubject$ = new ReplaySubject(1)\nconst online$ = onlineSubject$.asObservable()\nlet urlToHit\n\nonlineSubject$.next(true)\n\nfunction updateOnlineStatus (evt) {\n  if (navigator && navigator.online != undefined) {\n    onlineSubject$.next(navigator.online)\n  }\n}\n\nwindow.addEventListener('offline', updateOnlineStatus)\nwindow.addEventListener('online', () => createPoll())\n\nfunction checkIfOnline () {\n  if (urlToHit) {\n    return fetch(urlToHit).catch(e => {\n      console.warn(`polling failed`, e)\n      return {}\n    })\n  } else {\n    console.warn(`polling url needs to be set`)\n    return Promise.resolve({})\n  }\n}\n\nlet pollingSubscription\n\nfunction createPoll() {\n  clearPoll()\n  pollingSubscription = interval(1000).pipe(\n    filter((i) => {\n      if (i === 0) {\n        return true\n      } else if (i <= 15) {\n        return i % 5 === 0\n      } else if (i >= 20) {\n        return i % 10 === 0\n      }\n    }),\n    switchMap(() => from(checkIfOnline()))\n  ).subscribe(\n    (results) => {\n      if (results.status === 200) {\n        onlineSubject$.next(true)\n        clearPoll()\n      }\n    }\n  )\n}\n\nfunction clearPoll() {\n  if (pollingSubscription && pollingSubscription.unsubscribe) {\n    pollingSubscription.unsubscribe()\n  }\n}\n\nfunction setPollingUrl (url) {\n  urlToHit = url\n}\n\nexport {\n  online$,\n  setPollingUrl,\n}\n","import { online$ } from './online-listener.js'\n\nexport const onlineListener = online$\nexport { setPollingUrl } from './online-listener.js'\n"],"names":["onlineSubject$","ReplaySubject","online$","asObservable","urlToHit","next","updateOnlineStatus","navigator","online","window","addEventListener","createPoll","checkIfOnline","fetch","catch","e","console","warn","Promise","resolve","pollingSubscription","clearPoll","interval","pipe","filter","i","switchMap","from","subscribe","results","status","unsubscribe","setPollingUrl","url","onlineListener"],"mappings":"gGAOMA,CAAAA,cAAc,CAAG,GAAIC,CAAAA,aAAJ,CAAkB,CAAlB,EACjBC,OAAO,CAAGF,cAAc,CAACG,YAAfH,GAChB,GAAII,CAAAA,QAAJ,CAEAJ,cAAc,CAACK,IAAfL,KAEA,QAASM,CAAAA,kBAAT,EAAkC,CAC5BC,SAAS,EAAIA,SAAS,CAACC,MAAVD,MADe,EAE9BP,cAAc,CAACK,IAAfL,CAAoBO,SAAS,CAACC,MAA9BR,EAIJS,MAAM,CAACC,gBAAPD,CAAwB,SAAxBA,CAAmCH,kBAAnCG,EACAA,MAAM,CAACC,gBAAPD,CAAwB,QAAxBA,CAAkC,IAAME,UAAU,EAAlDF,EAEA,QAASG,CAAAA,aAAT,EAA0B,OACpBR,CAAAA,QADoB,CAEfS,KAAK,CAACT,QAAD,CAALS,CAAgBC,KAAhBD,CAAsBE,CAAC,GAC5BC,OAAO,CAACC,IAARD,iBAAAA,CAA+BD,CAA/BC,CAD4B,CAErB,EAFqB,CAAvBH,CAFe,EAOtBG,OAAO,CAACC,IAARD,8BAAAA,CAPsB,CAQfE,OAAO,CAACC,OAARD,CAAgB,EAAhBA,CARe,EAY1B,GAAIE,CAAAA,mBAAJ,CAEA,QAAST,CAAAA,UAAT,EAAsB,CACpBU,SAAS,EADW,CAEpBD,mBAAmB,CAAGE,QAAQ,CAAC,GAAD,CAARA,CAAeC,IAAfD,CACpBE,MAAM,CAAEC,CAAD,EAAO,IACF,CAANA,GAAAA,WADQ,MAGI,GAALA,EAAAA,CAHC,CAIO,CAAVA,EAAAA,CAAC,CAAG,CAJD,CAKI,EAALA,EAAAA,CALC,CAMQ,CAAXA,EAAAA,CAAC,CAAG,EAND,OAAR,CAAA,CADcH,CAUpBI,SAAS,CAAC,IAAMC,IAAI,CAACf,aAAa,EAAd,CAAX,CAVWU,EAWpBM,SAXoBN,CAYnBO,CAAD,EAAa,CACY,GAAnBA,GAAAA,CAAO,CAACC,MADD,GAET9B,cAAc,CAACK,IAAfL,IAFS,CAGTqB,SAAS,EAHA,CAZO,CAAAC,EAqBxB,QAASD,CAAAA,SAAT,EAAqB,CACfD,mBAAmB,EAAIA,mBAAmB,CAACW,WAD5B,EAEjBX,mBAAmB,CAACW,WAApBX,GAIJ,QAASY,CAAAA,aAAT,CAAwBC,CAAxB,CAA6B,CAC3B7B,QAAQ,CAAG6B,OChEAC,CAAAA,cAAc,CAAGhC"}